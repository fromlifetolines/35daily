 (cd "$(git rev-parse --show-toplevel)" && git apply --3way <<'EOF' 
diff --git a/index.html b/index.html
index e5948ea944c87b40187e86e306df0ccce81f45db..b4328cb57e3ef3ccd96448eb2e9ad4235a3cf021 100644
--- a/index.html
+++ b/index.html
@@ -166,251 +166,299 @@
       <select id="citySelect"></select>
       <label for="categorySelect">類別:</label>
       <select id="categorySelect"></select>
       <label for="keywordInput">關鍵字:</label>
       <input type="text" id="keywordInput" placeholder="輸入關鍵字">
       <button id="clearBtn">清除</button>
       <button id="toggleViewBtn">顯示清單</button>
     </div>
     <div class="filter-indicators">
       <label><input type="checkbox" class="indicator-chk" data-key="stroller">嬰兒車租借</label>
       <label><input type="checkbox" class="indicator-chk" data-key="nursing">哺乳室</label>
       <label><input type="checkbox" class="indicator-chk" data-key="diaper">尿布檯</label>
       <label><input type="checkbox" class="indicator-chk" data-key="hotwater">熱水提供</label>
       <label><input type="checkbox" class="indicator-chk" data-key="elevator">電梯</label>
       <label><input type="checkbox" class="indicator-chk" data-key="queue">排隊禮遇</label>
       <label><input type="checkbox" class="indicator-chk" data-key="play">遊戲區</label>
     </div>
   </div>
   <div id="results"></div>
   <div class="affiliate-section">
     推薦商品：
     <a href="https://shopee.tw/product/88627011/23823245035?aff_id=hstyle" target="_blank">
       HUGGIES 好奇 小森林 嬰兒紙尿褲
     </a>
   </div>
+  <script src="./facilities-data.js"></script>
   <script>
-    let facilities = [];
-    let citiesByRegion = {};
-    let allCities = [];
-    let viewMode = "card";
-    fetch("/data/facilities.json")
-      .then(response => response.json())
-      .then(data => {
-        facilities = data;
-        initializeFilters();
-        updateResults();  // initial display
-      })
-      .catch(error => {
-        console.error("資料載入失敗:", error);
-      });
-    function initializeFilters() {
-      const regionSelect = document.getElementById("regionSelect");
-      const citySelect = document.getElementById("citySelect");
-      const categorySelect = document.getElementById("categorySelect");
-      const regions = new Set();
-      const cities = new Set();
-      const categories = new Set();
-      facilities.forEach(item => {
-        regions.add(item.region);
-        cities.add(item.city);
-        categories.add(item.category);
-        if (!citiesByRegion[item.region]) {
-          citiesByRegion[item.region] = new Set();
-        }
-        citiesByRegion[item.region].add(item.city);
-      });
-      let regionList = Array.from(regions);
-      const regionOrder = ["北部","中部","南部","東部","其他","離島"];
-      regionList.sort((a, b) => {
-        const ai = regionOrder.indexOf(a);
-        const bi = regionOrder.indexOf(b);
-        if (ai !== -1 || bi !== -1) {
-          return (ai === -1 ? Infinity : ai) - (bi === -1 ? Infinity : bi);
-        }
-        return a.localeCompare(b);
-      });
-      regionSelect.innerHTML = "<option value=''>全部地區</option>";
-      regionList.forEach(region => {
-        const opt = document.createElement("option");
-        opt.value = region;
-        opt.textContent = region;
-        regionSelect.appendChild(opt);
-      });
-      allCities = Array.from(cities).sort((a, b) => a.localeCompare(b));
-      citySelect.innerHTML = "<option value=''>全部縣市</option>";
-      allCities.forEach(city => {
-        const opt = document.createElement("option");
-        opt.value = city;
-        opt.textContent = city;
-        citySelect.appendChild(opt);
-      });
-      const categoryList = Array.from(categories).sort((a, b) => a.localeCompare(b));
-      categorySelect.innerHTML = "<option value=''>全部類別</option>";
-      categoryList.forEach(cat => {
-        const opt = document.createElement("option");
-        opt.value = cat;
-        opt.textContent = cat;
-        categorySelect.appendChild(opt);
-      });
-      regionSelect.addEventListener("change", () => {
-        populateCityOptions(regionSelect.value);
-        updateResults();
-      });
-      citySelect.addEventListener("change", updateResults);
-      categorySelect.addEventListener("change", updateResults);
-      document.getElementById("keywordInput").addEventListener("input", updateResults);
-      document.querySelectorAll(".indicator-chk").forEach(chk => {
-        chk.addEventListener("change", updateResults);
-      });
-      document.getElementById("clearBtn").addEventListener("click", () => {
-        regionSelect.value = "";
-        populateCityOptions("");
-        citySelect.value = "";
-        categorySelect.value = "";
-        document.getElementById("keywordInput").value = "";
-        document.querySelectorAll(".indicator-chk").forEach(chk => chk.checked = false);
-        viewMode = "card";
-        document.getElementById("results").classList.remove("list-view");
-        document.getElementById("toggleViewBtn").textContent = "顯示清單";
-        updateResults();
-      });
-      document.getElementById("toggleViewBtn").addEventListener("click", () => {
-        const resultsDiv = document.getElementById("results");
-        if (viewMode === "card") {
-          viewMode = "list";
-          resultsDiv.classList.add("list-view");
-          document.getElementById("toggleViewBtn").textContent = "卡片模式";
-        } else {
-          viewMode = "card";
-          resultsDiv.classList.remove("list-view");
-          document.getElementById("toggleViewBtn").textContent = "顯示清單";
+    (function () {
+      let facilities = [];
+      let citiesByRegion = {};
+      let allCities = [];
+      let viewMode = "card";
+      const resultsContainer = document.getElementById("results");
+
+      resultsContainer.textContent = "資料載入中…";
+
+      loadFacilities()
+        .then(data => {
+          facilities = data;
+          initializeFilters();
+          updateResults();
+        })
+        .catch(error => {
+          console.error("資料載入失敗:", error);
+          resultsContainer.textContent = "資料載入失敗，請稍後再試。若以檔案直接開啟，請改以瀏覽器伺服器方式瀏覽。";
+        });
+
+      async function loadFacilities() {
+        try {
+          const response = await fetch(new URL("facilities.json", window.location.href), {
+            cache: "no-store"
+          });
+          if (!response.ok) {
+            throw new Error(`HTTP ${response.status}`);
+          }
+          const data = await response.json();
+          if (!Array.isArray(data) || data.length === 0) {
+            throw new Error("資料格式錯誤");
+          }
+          return data;
+        } catch (networkError) {
+          if (Array.isArray(window.FACILITIES_DATA)) {
+            console.warn("使用備援資料:", networkError);
+            return window.FACILITIES_DATA;
+          }
+          throw networkError;
         }
-        updateResults();
-      });
-    }
-    function populateCityOptions(region) {
-      const citySelect = document.getElementById("citySelect");
-      citySelect.innerHTML = "<option value=''>全部縣市</option>";
-      if (region && citiesByRegion[region]) {
-        Array.from(citiesByRegion[region]).sort((a, b) => a.localeCompare(b)).forEach(city => {
+      }
+
+      function initializeFilters() {
+        const regionSelect = document.getElementById("regionSelect");
+        const citySelect = document.getElementById("citySelect");
+        const categorySelect = document.getElementById("categorySelect");
+        const regions = new Set();
+        const cities = new Set();
+        const categories = new Set();
+
+        citiesByRegion = {};
+        facilities.forEach(item => {
+          regions.add(item.region);
+          cities.add(item.city);
+          categories.add(item.category);
+          if (!citiesByRegion[item.region]) {
+            citiesByRegion[item.region] = new Set();
+          }
+          citiesByRegion[item.region].add(item.city);
+        });
+
+        let regionList = Array.from(regions);
+        const regionOrder = ["北部","中部","南部","東部","其他","離島"];
+        regionList.sort((a, b) => {
+          const ai = regionOrder.indexOf(a);
+          const bi = regionOrder.indexOf(b);
+          if (ai !== -1 || bi !== -1) {
+            return (ai === -1 ? Infinity : ai) - (bi === -1 ? Infinity : bi);
+          }
+          return a.localeCompare(b);
+        });
+
+        regionSelect.innerHTML = "<option value=''>全部地區</option>";
+        regionList.forEach(region => {
           const opt = document.createElement("option");
-          opt.value = city;
-          opt.textContent = city;
-          citySelect.appendChild(opt);
+          opt.value = region;
+          opt.textContent = region;
+          regionSelect.appendChild(opt);
         });
-      } else {
+
+        allCities = Array.from(cities).sort((a, b) => a.localeCompare(b));
+        citySelect.innerHTML = "<option value=''>全部縣市</option>";
         allCities.forEach(city => {
           const opt = document.createElement("option");
           opt.value = city;
           opt.textContent = city;
           citySelect.appendChild(opt);
         });
+
+        const categoryList = Array.from(categories).sort((a, b) => a.localeCompare(b));
+        categorySelect.innerHTML = "<option value=''>全部類別</option>";
+        categoryList.forEach(cat => {
+          const opt = document.createElement("option");
+          opt.value = cat;
+          opt.textContent = cat;
+          categorySelect.appendChild(opt);
+        });
+
+        regionSelect.addEventListener("change", () => {
+          populateCityOptions(regionSelect.value);
+          updateResults();
+        });
+        citySelect.addEventListener("change", updateResults);
+        categorySelect.addEventListener("change", updateResults);
+        document.getElementById("keywordInput").addEventListener("input", updateResults);
+        document.querySelectorAll(".indicator-chk").forEach(chk => {
+          chk.addEventListener("change", updateResults);
+        });
+        document.getElementById("clearBtn").addEventListener("click", () => {
+          regionSelect.value = "";
+          populateCityOptions("");
+          citySelect.value = "";
+          categorySelect.value = "";
+          document.getElementById("keywordInput").value = "";
+          document.querySelectorAll(".indicator-chk").forEach(chk => (chk.checked = false));
+          viewMode = "card";
+          document.getElementById("results").classList.remove("list-view");
+          document.getElementById("toggleViewBtn").textContent = "顯示清單";
+          updateResults();
+        });
+        document.getElementById("toggleViewBtn").addEventListener("click", () => {
+          const resultsDiv = document.getElementById("results");
+          if (viewMode === "card") {
+            viewMode = "list";
+            resultsDiv.classList.add("list-view");
+            document.getElementById("toggleViewBtn").textContent = "卡片模式";
+          } else {
+            viewMode = "card";
+            resultsDiv.classList.remove("list-view");
+            document.getElementById("toggleViewBtn").textContent = "顯示清單";
+          }
+          updateResults();
+        });
       }
-    }
-    function updateResults() {
-      const regionValue = document.getElementById("regionSelect").value;
-      const cityValue = document.getElementById("citySelect").value;
-      const categoryValue = document.getElementById("categorySelect").value;
-      const keywordValue = document.getElementById("keywordInput").value.trim().toLowerCase();
-      const requiredIndicators = Array.from(document.querySelectorAll(".indicator-chk:checked")).map(chk => chk.getAttribute("data-key"));
-      const resultsDiv = document.getElementById("results");
-      resultsDiv.innerHTML = "";
-      let count = 0;
-      facilities.forEach(item => {
-        if (regionValue && item.region !== regionValue) return;
-        if (cityValue && item.city !== cityValue) return;
-        if (categoryValue && item.category !== categoryValue) return;
-        if (keywordValue) {
-          const text = (item.name + " " + item.city + " " + item.category).toLowerCase();
-          if (text.indexOf(keywordValue) === -1) return;
-        }
-        for (let key of requiredIndicators) {
-          if (!item.indicators[key]) return;
+
+      function populateCityOptions(region) {
+        const citySelect = document.getElementById("citySelect");
+        citySelect.innerHTML = "<option value=''>全部縣市</option>";
+        if (region && citiesByRegion[region]) {
+          Array.from(citiesByRegion[region]).sort((a, b) => a.localeCompare(b)).forEach(city => {
+            const opt = document.createElement("option");
+            opt.value = city;
+            opt.textContent = city;
+            citySelect.appendChild(opt);
+          });
+        } else {
+          allCities.forEach(city => {
+            const opt = document.createElement("option");
+            opt.value = city;
+            opt.textContent = city;
+            citySelect.appendChild(opt);
+          });
         }
-        const resultItem = document.createElement("div");
-        resultItem.className = "result-item";
-        if (viewMode === "card") {
-          const nameEl = document.createElement("h3");
-          nameEl.className = "facility-name";
-          nameEl.textContent = item.name;
-          if (item.floor) {
-            const floorSmall = document.createElement("small");
-            floorSmall.textContent = item.floor;
-            nameEl.appendChild(document.createTextNode(" "));
-            nameEl.appendChild(floorSmall);
+      }
+
+      function updateResults() {
+        const regionValue = document.getElementById("regionSelect").value;
+        const cityValue = document.getElementById("citySelect").value;
+        const categoryValue = document.getElementById("categorySelect").value;
+        const keywordValue = document.getElementById("keywordInput").value.trim().toLowerCase();
+        const requiredIndicators = Array.from(document.querySelectorAll(".indicator-chk:checked")).map(chk =>
+          chk.getAttribute("data-key")
+        );
+        const resultsDiv = document.getElementById("results");
+        resultsDiv.innerHTML = "";
+        let count = 0;
+
+        facilities.forEach(item => {
+          if (regionValue && item.region !== regionValue) return;
+          if (cityValue && item.city !== cityValue) return;
+          if (categoryValue && item.category !== categoryValue) return;
+          if (keywordValue) {
+            const text = (item.name + " " + item.city + " " + item.category).toLowerCase();
+            if (text.indexOf(keywordValue) === -1) return;
           }
-          resultItem.appendChild(nameEl);
-          const locEl = document.createElement("p");
-          locEl.className = "location-category";
-          locEl.textContent = item.region + " / " + item.city + "，類別：" + item.category;
-          resultItem.appendChild(locEl);
-          const featuresEl = document.createElement("p");
-          featuresEl.className = "features";
-          const featureList = [];
-          if (item.indicators.stroller) featureList.push("嬰兒車租借");
-          if (item.indicators.nursing) featureList.push("哺乳室");
-          if (item.indicators.diaper) featureList.push("尿布檯");
-          if (item.indicators.hotwater) featureList.push("熱水提供");
-          if (item.indicators.elevator) featureList.push("電梯");
-          if (item.indicators.queue) featureList.push("排隊禮遇");
-          if (item.indicators.play) featureList.push("遊戲區");
-          if (featureList.length > 0) {
-            featuresEl.textContent = "提供: " + featureList.join("、 ");
-          } else {
-            featuresEl.textContent = "無特殊設施";
+          for (const key of requiredIndicators) {
+            if (!item.indicators[key]) return;
           }
-          resultItem.appendChild(featuresEl);
-          const sourceEl = document.createElement("p");
-          sourceEl.className = "source-link";
-          sourceEl.textContent = "資料來源：";
-          const link = document.createElement("a");
-          link.href = item.source;
-          link.textContent = "詳情";
-          link.target = "_blank";
-          sourceEl.appendChild(link);
-          resultItem.appendChild(sourceEl);
-        } else {
-          const nameEl = document.createElement("span");
-          nameEl.className = "facility-name";
-          nameEl.textContent = item.name;
-          if (item.floor) {
-            const floorSmall = document.createElement("small");
-            floorSmall.textContent = " (" + item.floor + ")";
-            nameEl.appendChild(floorSmall);
+
+          const resultItem = document.createElement("div");
+          resultItem.className = "result-item";
+
+          if (viewMode === "card") {
+            const nameEl = document.createElement("h3");
+            nameEl.className = "facility-name";
+            nameEl.textContent = item.name;
+            if (item.floor) {
+              const floorSmall = document.createElement("small");
+              floorSmall.textContent = item.floor;
+              nameEl.appendChild(document.createTextNode(" "));
+              nameEl.appendChild(floorSmall);
+            }
+            resultItem.appendChild(nameEl);
+
+            const locEl = document.createElement("p");
+            locEl.className = "location-category";
+            locEl.textContent = `${item.region} / ${item.city}，類別：${item.category}`;
+            resultItem.appendChild(locEl);
+
+            const featuresEl = document.createElement("p");
+            featuresEl.className = "features";
+            const featureList = [];
+            if (item.indicators.stroller) featureList.push("嬰兒車租借");
+            if (item.indicators.nursing) featureList.push("哺乳室");
+            if (item.indicators.diaper) featureList.push("尿布檯");
+            if (item.indicators.hotwater) featureList.push("熱水提供");
+            if (item.indicators.elevator) featureList.push("電梯");
+            if (item.indicators.queue) featureList.push("排隊禮遇");
+            if (item.indicators.play) featureList.push("遊戲區");
+            featuresEl.textContent = featureList.length > 0 ? `提供: ${featureList.join("、 ")}` : "無特殊設施";
+            resultItem.appendChild(featuresEl);
+
+            const sourceEl = document.createElement("p");
+            sourceEl.className = "source-link";
+            sourceEl.textContent = "資料來源：";
+            const link = document.createElement("a");
+            link.href = item.source;
+            link.textContent = "詳情";
+            link.target = "_blank";
+            sourceEl.appendChild(link);
+            resultItem.appendChild(sourceEl);
+          } else {
+            const nameEl = document.createElement("span");
+            nameEl.className = "facility-name";
+            nameEl.textContent = item.name;
+            if (item.floor) {
+              const floorSmall = document.createElement("small");
+              floorSmall.textContent = ` (${item.floor})`;
+              nameEl.appendChild(floorSmall);
+            }
+            resultItem.appendChild(nameEl);
+
+            const locCatEl = document.createElement("span");
+            locCatEl.className = "location-category";
+            locCatEl.textContent = `${item.region}/${item.city} ${item.category}`;
+            resultItem.appendChild(locCatEl);
+
+            const featEl = document.createElement("span");
+            featEl.className = "features";
+            const feats = [];
+            if (item.indicators.stroller) feats.push("嬰兒車租借");
+            if (item.indicators.nursing) feats.push("哺乳室");
+            if (item.indicators.diaper) feats.push("尿布檯");
+            if (item.indicators.hotwater) feats.push("熱水提供");
+            if (item.indicators.elevator) feats.push("電梯");
+            if (item.indicators.queue) feats.push("排隊禮遇");
+            if (item.indicators.play) feats.push("遊戲區");
+            featEl.textContent = feats.length ? feats.join("、 ") : "無特殊設施";
+            resultItem.appendChild(featEl);
+
+            const srcEl = document.createElement("span");
+            srcEl.className = "source-link";
+            const link = document.createElement("a");
+            link.href = item.source;
+            link.textContent = "詳情";
+            link.target = "_blank";
+            srcEl.appendChild(link);
+            resultItem.appendChild(srcEl);
           }
-          resultItem.appendChild(nameEl);
-          const locCatEl = document.createElement("span");
-          locCatEl.className = "location-category";
-          locCatEl.textContent = item.region + "/" + item.city + " " + item.category;
-          resultItem.appendChild(locCatEl);
-          const featEl = document.createElement("span");
-          featEl.className = "features";
-          const feats = [];
-          if (item.indicators.stroller) feats.push("嬰兒車租借");
-          if (item.indicators.nursing) feats.push("哺乳室");
-          if (item.indicators.diaper) feats.push("尿布檯");
-          if (item.indicators.hotwater) feats.push("熱水提供");
-          if (item.indicators.elevator) feats.push("電梯");
-          if (item.indicators.queue) feats.push("排隊禮遇");
-          if (item.indicators.play) feats.push("遊戲區");
-          featEl.textContent = feats.length ? feats.join("、 ") : "無特殊設施";
-          resultItem.appendChild(featEl);
-          const srcEl = document.createElement("span");
-          srcEl.className = "source-link";
-          const link = document.createElement("a");
-          link.href = item.source;
-          link.textContent = "詳情";
-          link.target = "_blank";
-          srcEl.appendChild(link);
-          resultItem.appendChild(srcEl);
+
+          resultsDiv.appendChild(resultItem);
+          count++;
+        });
+
+        if (count === 0) {
+          resultsDiv.textContent = "未找到符合條件的結果。";
         }
-        resultsDiv.appendChild(resultItem);
-        count++;
-      });
-      if (count === 0) {
-        resultsDiv.textContent = "未找到符合條件的結果。";
       }
-    }
+    })();
   </script>
 </body>
 </html>
 
EOF
)
