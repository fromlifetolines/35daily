<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>嬰幼兒友善地點｜清單 & 卡片檢索</title>
  <style>
    :root{
      --bg:#0b0f14;
      --panel:#121923;
      --muted:#8a98a8;
      --text:#e7edf4;
      --accent:#3b82f6;
      --ok:#16a34a;
      --warn:#f59e0b;
      --bad:#ef4444;
      --unknown:#6b7280;
      --chip:#1a2330;
      --card:#0f1a25;
      --border:#1f2a37;
      --shadow: 0 6px 18px rgba(0,0,0,.25);
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:15px/1.6 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans TC", "PingFang TC", "Microsoft JhengHei", sans-serif}
    header{position:sticky;top:0;z-index:50;background:linear-gradient(180deg, rgba(11,15,20,.98), rgba(11,15,20,.92) 70%, rgba(11,15,20,0));backdrop-filter:saturate(120%) blur(10px);}
    .bar{max-width:1100px;margin:0 auto;padding:14px 16px;display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    h1{font-size:20px;margin:0 8px 0 0;font-weight:700;letter-spacing:.5px}
    .pill{display:inline-flex;gap:8px;align-items:center;background:var(--panel);border:1px solid var(--border);border-radius:999px;padding:6px 10px;color:var(--muted)}
    .filters{display:flex;flex-wrap:wrap;gap:8px}
    .filters label{display:flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:var(--panel);border:1px solid var(--border);cursor:pointer;user-select:none}
    .filters input{accent-color:var(--accent)}
    .mode{margin-left:auto;display:flex;gap:6px;align-items:center}
    .mode button{background:var(--panel);border:1px solid var(--border);color:var(--text);padding:6px 10px;border-radius:8px;cursor:pointer}
    .mode button.active{background:var(--accent)}

    main{max-width:1100px;margin:12px auto;padding:0 16px 24px}
    .grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:12px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:12px;box-shadow:var(--shadow);display:flex;flex-direction:column;gap:8px}
    .title{display:flex;align-items:center;gap:10px}
    .title .badge{font-size:12px;background:var(--chip);border:1px solid var(--border);padding:2px 8px;border-radius:999px;color:var(--muted)}
    .meta{font-size:13px;color:var(--muted);display:flex;flex-wrap:wrap;gap:6px}
    .icons{display:flex;flex-wrap:wrap;gap:6px;margin-top:2px}
    .icon{display:inline-flex;align-items:center;gap:6px;padding:5px 8px;border-radius:999px;background:var(--panel);border:1px solid var(--border);font-size:12px;line-height:1}
    .icon svg{width:16px;height:16px;display:block}
    .ok{color:#d1fae5;background:rgba(22,163,74,.15);border-color:rgba(22,163,74,.35)}
    .unknown{color:#e5e7eb;background:rgba(107,114,128,.15);border-color:rgba(107,114,128,.35)}
    .no{color:#fee2e2;background:rgba(239,68,68,.15);border-color:rgba(239,68,68,.35)}
    a.link{color:#93c5fd;text-decoration:none}
    a.link:hover{text-decoration:underline}

    /* list (table) mode */
    .list{width:100%;border-collapse:separate;border-spacing:0 8px}
    .list th,.list td{padding:10px 12px}
    .list th{position:sticky;top:64px;background:var(--bg);text-align:left;color:var(--muted);font-weight:600;border-bottom:1px solid var(--border);z-index:2}
    .row{background:var(--card);border:1px solid var(--border);box-shadow:var(--shadow)}
    .row td:first-child{border-radius:12px 0 0 12px}
    .row td:last-child{border-radius:0 12px 12px 0}
    .row .icons{gap:4px}
    .row .icon{padding:4px 6px}

    /* compact spacing on small screens */
    @media (max-width:640px){
      .grid{grid-template-columns:1fr}
      .icons{gap:4px}
      .icon{padding:4px 6px}
      .list .hide-sm{display:none}
      .bar{gap:8px}
      .filters label{padding:5px 8px}
      .mode button{padding:6px 10px}
    }
  </style>

  <!-- SVG icon sprites -->
  <svg width="0" height="0" style="position:absolute;visibility:hidden">
    <defs>
      <symbol id="i-stroller" viewBox="0 0 24 24">
        <path fill="currentColor" d="M9 6a5 5 0 0 1 5 5h6a7 7 0 0 0-7-7H6.5A2.5 2.5 0 0 0 4 6.5V9h5zM6 14a3 3 0 1 0 0 6a3 3 0 0 0 0-6m10 0a3 3 0 1 0 0 6a3 3 0 0 0 0-6M5 13h11a1 1 0 1 1 0 2H5a1 1 0 1 1 0-2"/>
      </symbol>
      <symbol id="i-nursing" viewBox="0 0 24 24">
        <path fill="currentColor" d="M12 3a3 3 0 0 1 3 3v1.5a2.5 2.5 0 1 1-5 0V6a3 3 0 0 1 2-2.83V3Zm7 12.5c0 3.59-3.58 6.5-7 6.5s-7-2.91-7-6.5c0-2.28 2.17-3.67 4.5-4.44c.6-.2 1.25.11 1.45.72a3 3 0 0 0 5.1.63c.29-.37.8-.5.1.34c1.1.39 1.7 1.09 1.7 1.43Z"/>
      </symbol>
      <symbol id="i-diaper" viewBox="0 0 24 24">
        <path fill="currentColor" d="M3 7a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v2c0 1.66-1.34 3-3 3h-1l-2 3H9L7 12H6c-1.66 0-3-1.34-3-3V7Zm7 9h4l-1 2H11l-1-2Z"/>
      </symbol>
      <symbol id="i-hotwater" viewBox="0 0 24 24">
        <path fill="currentColor" d="M7 3h8a2 2 0 0 1 2 2v1h1a3 3 0 0 1 3 3v2h-2V9a1 1 0 0 0-1-1h-1v8a3 3 0 0 1-3 3H9a3 3 0 0 1-3-3V5a2 2 0 0 1 2-2Zm1 2v12a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V5H8Zm2 3c.83 0 1.5.67 1.5 1.5S10.83 11 10 11s-1.5-.67-1.5-1.5S9.17 8 10 8Zm6.5 9a.5.5 0 1 1 0 1a.5.5 0 0 1 0-1Z"/>
      </symbol>
      <symbol id="i-elevator" viewBox="0 0 24 24">
        <path fill="currentColor" d="M4 3h16v18H4V3Zm2 2v14h12V5H6Zm2 2h3v3l2-3h3l-2.5-4L11 7Zm6 8h-3v-3l-2 3H6l2.5 4L14 15Z"/>
      </symbol>
      <symbol id="i-queue" viewBox="0 0 24 24">
        <path fill="currentColor" d="M9 7a3 3 0 1 0 0-6a3 3 0 0 0 0 6Zm7 4a3 3 0 1 0 0-6a3 3 0 0 0 0 6ZM2 22v-2a5 5 0 0 1 5-5h4a5 5 0 0 1 5 5v2H2Zm17 0v-2a6.97 6.97 0 0 0-2.46-5.3A5 5 0 0 1 20 20v2h-1Z"/>
      </symbol>
      <symbol id="i-play" viewBox="0 0 24 24">
        <path fill="currentColor" d="M7 3h3v3H7V3Zm-2 5h7v7H5V8Zm9-5h5v5h-5V3Zm1 6h3v9h-3V9Zm-6 9h5v3H9v-3Z"/>
      </symbol>
      <symbol id="i-link" viewBox="0 0 24 24">
        <path fill="currentColor" d="M10.59 13.41a1 1 0 0 0 1.41 1.41l3.3-3.3a3 3 0 1 0-4.24-4.24l-1.59 1.59a1 1 0 1 0 1.41 1.41l1.59-1.59a1 1 0 1 1 1.41 1.41l-3.3 3.3ZM13.41 10.59a1 1 0 0 0-1.41-1.41l-3.3 3.3a3 3 0 0 0 4.24 4.24l1.59-1.59a1 1 0 0 0-1.41-1.41l-1.59 1.59a1 1 0 0 1-1.41-1.41l3.3-3.3Z"/>
      </symbol>
    </defs>
  </svg>
</head>
<body>
  <header>
    <div class="bar">
      <h1>嬰幼兒友善地點</h1>
      <div class="pill">篩選設施：</div>
      <div class="filters" id="filters">
        <label><input type="checkbox" value="stroller"> 嬰兒車租借</label>
        <label><input type="checkbox" value="nursing"> 哺(集)乳室</label>
        <label><input type="checkbox" value="diaper"> 尿布檯</label>
        <label><input type="checkbox" value="hotwater"> 熱水/飲水</label>
        <label><input type="checkbox" value="elevator"> 電梯</label>
        <label><input type="checkbox" value="queue"> 排隊禮遇</label>
        <label><input type="checkbox" value="play"> 遊戲區</label>
      </div>
      <div class="mode">
        <button id="btnCard" class="active">卡片</button>
        <button id="btnList">清單</button>
      </div>
    </div>
  </header>

  <main>
    <section id="cardView" class="grid"></section>
    <section id="listView" style="display:none">
      <table class="list" id="listTable">
        <thead>
          <tr>
            <th>名稱</th>
            <th class="hide-sm">地區/城市</th>
            <th>類別</th>
            <th>設施</th>
          </tr>
        </thead>
        <tbody id="listBody"></tbody>
      </table>
    </section>
  </main>

  <script>
    const ICONS = {
      stroller: { label: "嬰兒車租借", icon: "i-stroller" },
      nursing:  { label: "哺(集)乳室", icon: "i-nursing" },
      diaper:   { label: "尿布檯", icon: "i-diaper" },
      hotwater: { label: "熱水/飲水", icon: "i-hotwater" },
      elevator: { label: "電梯", icon: "i-elevator" },
      queue:    { label: "排隊禮遇", icon: "i-queue" },
      play:     { label: "遊戲區", icon: "i-play" }
    };

    const state = { filters: new Set(), data: [] };

    document.getElementById('filters').addEventListener('change', e => {
      if(e.target && e.target.type === 'checkbox'){
        if(e.target.checked) state.filters.add(e.target.value);
        else state.filters.delete(e.target.value);
        render();
      }
    });

    function badge(v){
      if(v === true) return '有';
      if(v === false) return '無';
      return '未知';
    }

    function iconTag(key, val){
      const meta = ICONS[key];
      let cls = 'unknown';
      if(val === true) cls = 'ok';
      else if(val === false) cls = 'no';
      return `<span class="icon ${cls}" title="${meta.label}：${badge(val)}">
        <svg><use href="#${meta.icon}"/></svg>${meta.label}
      </span>`;
    }

    function passFilters(rec){
      if(state.filters.size === 0) return true;
      for(const k of state.filters){
        const v = rec.indicators?.[k];
        if(v !== true) return false;
      }
      return true;
    }

    function card(rec){
      const ind = rec.indicators || {};
      const chips = Object.keys(ICONS).map(k => iconTag(k, ind[k])).join('');
      const src = rec.source ? `<a class="link" href="${rec.source}" target="_blank" rel="noopener">官方資訊<svg style="width:14px;height:14px;vertical-align:-2px;margin-left:6px"><use href="#i-link"/></svg></a>` : '';
      const floor = rec.floor ? `｜樓層：${rec.floor}` : '';
      return `<article class="card">
        <div class="title">
          <div style="font-weight:700;font-size:16px">${rec.name}</div>
          <span class="badge">${rec.region}・${rec.city}</span>
          <span class="badge">${rec.category}</span>
        </div>
        <div class="meta">${src}${floor}</div>
        <div class="icons">${chips}</div>
      </article>`;
    }

    function listRow(rec){
      const ind = rec.indicators || {};
      const chips = Object.keys(ICONS).map(k => iconTag(k, ind[k])).join('');
      return `<tr class="row">
        <td style="font-weight:600">${rec.name}</td>
        <td class="hide-sm">${rec.region}・${rec.city}</td>
        <td>${rec.category}</td>
        <td><div class="icons">${chips}</div></td>
      </tr>`;
    }

    function render(){
      const data = state.data.filter(passFilters);
      document.getElementById('cardView').innerHTML = data.map(card).join('');
      document.getElementById('listBody').innerHTML = data.map(listRow).join('');
    }

    document.getElementById('btnCard').addEventListener('click', ()=>{
      document.getElementById('btnCard').classList.add('active');
      document.getElementById('btnList').classList.remove('active');
      document.getElementById('cardView').style.display='grid';
      document.getElementById('listView').style.display='none';
    });
    document.getElementById('btnList').addEventListener('click', ()=>{
      document.getElementById('btnList').classList.add('active');
      document.getElementById('btnCard').classList.remove('active');
      document.getElementById('cardView').style.display='none';
      document.getElementById('listView').style.display='block';
    });

    async function loadData(){
      try{
        const r = await fetch('facilities.json', {cache:'no-store'});
        if(r.ok){
          state.data = await r.json();
        }else{
          throw new Error('no json');
        }
      }catch(e){
        state.data = [];
      }
      render();
    }
    loadData();
  </script>
</body>
</html>